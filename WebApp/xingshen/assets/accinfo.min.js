function modifyLog(){function n(t,i,r){var u,f,e,o;for(u in t)if(typeof t[u]=="object"&&t[u]!=null)if(t[u].push!=undefined)f=[],n(t[u],i[u],f),f.length>0&&(r[u]=f);else{e={};n(t[u],i[u],e);for(o in e){r[u]=e;break}}else t[u]!=i[u]&&(r[u]=t[u]);return r}return n(player_data,player_data_bak,{})}function fake_click(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null);n.dispatchEvent(t)}function cfgdownload(n,t){var r=window.URL||window.webkitURL||window,u=new Blob([t]),i=document.createElementNS("http://www.w3.org/1999/xhtml","a");i.href=r.createObjectURL(u);i.download=n;fake_click(i)}function htt(){var n=[{t:5,i:59},{t:6,i:60},{t:11,i:59},{t:7,i:63},{t:0,i:163},{t:1,i:60},{t:2,i:64},{t:3,i:70},{t:4,i:60},{t:2,i:64},{t:4,i:60}],i=parseInt(player_data.playerDict.itemID);for(var t in n)player_data.playerDict.packageArr.push({itemType:n[t].t.toString(),childType:n[t].i.toString(),addDict:{},itemID:(i+parseInt(t)+1).toString(),qianghuaLv:"10"});player_data.playerDict.itemID=(i+n.length+2).toString()}var player_data,player_data_bak,selectedRow;layui.use(["layer","element","table"],function(){function f(u){var f=function(){i.render({elem:"#warninglist",cellMinWidth:40,height:"400px",cols:[[{field:"id",width:40,title:"ID"},{field:"jgrq",width:160,title:"日期"},{field:"jgxx",width:320,title:"内容"},{width:66,toolbar:"#toolsbar",title:'<a class="layui-btn layui-btn-danger layui-btn-xs warnclear">全删<\/a>'}]],data:u,limit:99999});n(".warnclear").click(function(){return e(-1),!1})};u.length>0&&(r&&r.is(":visible")?f():t.open({type:1,title:"警告信息",resize:!1,area:["610px","465px"],content:n(".dialog .warninglistdlg"),success:function(n){r=n;f()}}))}function e(i,r){t.load(2);n.ajax({url:window.location.pathname+"?a=delwarning&uid="+uid+"&wid="+i,"async":!0,type:"POST",dataType:"json",success:function(n){t.closeAll("loading");n.ok?r&&r.tr.siblings().length>0?r.del():t.closeAll("page"):t.msg(n.msg)},error:function(n){t.closeAll("loading");t.msg(n.responseText,{icon:2})}})}function o(n){var i="",t,r;for(t in n)i+='<tr class="data" data-id="'+t+'"><td>'+n[t].itemID+"<\/td>",i+=ALLFILE_Item["ITEMFILE"+n[t].itemType]&&ALLFILE_Item["ITEMFILE"+n[t].itemType][n[t].childType]?"<td>"+ALLFILE_Item["ITEMFILE"+n[t].itemType][n[t].childType].name+"<\/td>":'<td style="color:red">未知物品<\/td>',i+="<td>"+itemlx[n[t].itemType]+"<\/td>",r="",typeof n[t].num!="undefined"&&(r+="，数量："+n[t].num+""),typeof n[t].qianghuaLv!="undefined"&&(r+="，强化："+n[t].qianghuaLv),i+="<td>"+r.substr(1)+"<\/td>",i+="<\/tr>";return i}function u(i,r,u){var f;try{f=JSON.parse(r)}catch(e){t.msg("数据保存失败！请再次检查内容！");return}i[selectedRow.data("id")]=f;n(u).closest(".editor").hide();t.msg("ok",{time:1e3})}var t=layui.layer,n=layui.$,i=layui.table,r;player_data=JSON.parse(playerdata.data.player_data);player_data_bak=JSON.parse(playerdata.data.player_data);layui.util.fixbar({bar1:"&#xe60A;",bar2:"&#xe612;",css:{bottom:"50%"},click:function(i){i=="bar1"?t.open({content:n(".dialog .finditemdlg"),id:"adminPopupR",title:"物品查询",anim:2,isOutAnim:!1,closeBtn:!1,offset:"r",shadeClose:!0,area:"650px",skin:"layui-layer-adminRight",type:1,end:function(){layui.$(".finditemdlg tr").remove()}}):i=="bar2"&&t.open({content:n(".dialog .findroledlg"),id:"adminPopupR",title:"人物查询",anim:2,isOutAnim:!1,closeBtn:!1,offset:"r",shadeClose:!0,area:"80%",skin:"layui-layer-adminRight",type:1,end:function(){layui.$(".findroledlg tr").remove()}})}});i.on("tool(warninglist)",function(n){n.event=="del"&&e(n.data.id,n)});f(warningdata);setInterval(function(){n.ajax({url:window.location.pathname+"?a=refreshwarn&uid="+uid,"async":!0,type:"POST",dataType:"json",success:function(n){n.ok&&f(n.data)},error:function(){}})},5e3);n(".package tbody").append(o(player_data.playerDict.packageArr));n(".cangku tbody").append(o(player_data.playerDict.cangkuArr)),function(){var t="";for(var i in ALLFILE_Item.KEYSTRNAME)t+=i+":"+ALLFILE_Item.KEYSTRNAME[i].name+";";n("table.package .meta .layui-select").html(t);n("table.cangku .meta .layui-select").html(t)}(),function(){var t="";for(var i in player_data.playerDict.battleRolesArr)t+='<tr class="data" data-t="1" data-id="'+i+'"><td>√<\/td>',t+="<td>"+ALLFILE_Item.ROLEFILE[player_data.playerDict.battleRolesArr[i].ID].roleName+"<\/td>",t+="<td><\/td>",t+="<td><\/td>",t+="<\/tr>";for(i in player_data.playerDict.rolesArr)t+='<tr class="data" data-t="2" data-id="'+i+'"><td><\/td>',t+="<td>"+ALLFILE_Item.ROLEFILE[player_data.playerDict.rolesArr[i].ID].roleName+"<\/td>",t+="<td><\/td>",t+="<td><\/td>",t+="<\/tr>";n(".roles tbody").append(t)}(),function(){var r,i,t;n(".layui-tab-item.base input").each(function(){if(this.name=="firstPlayTime"){var t=(Math.round((new Date).getTime()/1e3)-player_data.playerDict.firstPlayTime)/86400;n(this).val(Math.round(t))}else n(this).val(player_data.playerDict[this.name])});n(".layui-tab-item.base div[data-key]").each(function(){n(this).html(player_data.playerDict[n(this).data("key")])});r=player_data.playerDict.juntuanExp||1;for(t in ALLFILE_Item.EXPLEVEL)parseInt(ALLFILE_Item.EXPLEVEL[t])<=r&&n(".layui-tab-item.base .juntdj").text(parseInt(t)+1);i={};for(t in player_data.playerDict)typeof player_data.playerDict[t]!="object"&&(i[t]=player_data.playerDict[t]);n(".layui-tab-item.basejson .basefulldata").val(JSON.stringify(i,null,"\t"))}();n("table.package tr.data").click(function(){var t,i;selectedRow=n(this);t=n("table.package tr.editor");t.is(":visible")&&t.is(selectedRow.next())?t.hide():(i=player_data.playerDict.packageArr[selectedRow.data("id")],t.find(".fulldata").val(JSON.stringify(i,null,"\t")),t.insertAfter(selectedRow).show())});n("table.cangku tr.data").click(function(){var t,i;selectedRow=n(this);t=n("table.cangku tr.editor");t.is(":visible")&&t.is(selectedRow.next())?t.hide():(i=player_data.playerDict.cangkuArr[selectedRow.data("id")],t.find(".fulldata").val(JSON.stringify(i,null,"\t")),t.insertAfter(selectedRow).show())});n("table.roles tr.data").click(function(){var t,i;selectedRow=n(this);t=n("table.roles tr.editor");t.is(":visible")&&t.is(selectedRow.next())?t.hide():(i=selectedRow.data("t")=="1"?player_data.playerDict.battleRolesArr[selectedRow.data("id")]:player_data.playerDict.rolesArr[selectedRow.data("id")],t.find(".fulldata").val(JSON.stringify(i,null,"\t")),t.insertAfter(selectedRow).show())});n("table.translations tr.editor .layui-btn").click(function(){var i={orig:selectedRow.data("orig"),score:sx.config.value,trans:n("tr.editor .foreign-text").val()};console.log(JSON.stringify(i));t.load(2);layui.$.ajax({type:"POST",url:location.href,data:JSON.stringify(i),dataType:"json",contentType:"application/json; charset=utf-8",success:function(n){t.closeAll("loading");n.ok?t.msg("已保存",{time:1e3}):t.msg(n.msg)},error:function(n){t.closeAll("loading");t.msg(n.responseText,{icon:2})}});n("table.translations tr.editor").hide()});n(".layui-tab-item.base input").change(function(){var t=parseInt(n(this).val()),r,i;if(isNaN(t)||(player_data.playerDict[this.name]=t.toString()),n(this).val(player_data.playerDict[this.name]),this.name=="juntuanExp"){r=player_data.playerDict.juntuanExp||1;for(i in ALLFILE_Item.EXPLEVEL)parseInt(ALLFILE_Item.EXPLEVEL[i])<=r&&n(".layui-tab-item.base .juntdj").text(parseInt(i)+1)}else this.name=="firstPlayTime"&&(player_data.playerDict.firstPlayTime=(Math.round((new Date).getTime()/1e3)-t*86400).toString())});n("#btn_ok").click(function(){t.load(2);n.ajax({url:window.location.pathname+"?a=save&uid="+uid,"async":!0,type:"POST",data:JSON.stringify(player_data),dataType:"json",success:function(n){t.closeAll("loading");n.ok?(t.msg("保存成功"),location.reload()):t.msg(n.msg)},error:function(n){t.closeAll("loading");t.msg(n.responseText,{icon:2})}})});n("#btn_downfirst").click(function(){t.load(2);n.ajax({url:window.location.pathname+"?a=downfirst&uid="+uid,"async":!0,type:"POST",data:JSON.stringify(player_data),dataType:"json",success:function(n){t.closeAll("loading");n.ok?(t.msg("ok"),cfgdownload("a.txt",n.data)):t.msg(n.msg)},error:function(n){t.closeAll("loading");t.msg(n.responseText,{icon:2})}})});n("#btn_renewData").click(function(){t.load(2);n.ajax({url:window.location.pathname+"?a=rdt&uid="+uid,"async":!0,type:"POST",dataType:"json",success:function(n){t.closeAll("loading");n.ok?location.reload():t.msg(n.msg)},error:function(n){t.closeAll("loading");t.msg(n.responseText,{icon:2})}})});n(".package .editor .layui-btn").click(function(){u(player_data.playerDict.packageArr,n(".package .editor .fulldata").val(),this)});n(".cangku .editor .layui-btn").click(function(){u(player_data.playerDict.cangkuArr,n(".cangku .editor .fulldata").val(),this)});n(".roles .editor .layui-btn").click(function(){var t;t=selectedRow.data("t")=="1"?player_data.playerDict.battleRolesArr:player_data.playerDict.rolesArr;u(t,n(".roles .editor .fulldata").val(),this)});n("#btn_itemsearch").click(function(){var f=n("#itemsearchkey").val(),o=[],s=[],h=[],c=[],t,e,r,u;for(t in ALLFILE_Item)if(t.startsWith("ITEMFILE")){e=parseInt(t.substr(8));for(r in ALLFILE_Item[t])(f==""||ALLFILE_Item[t][r].ID==f||ALLFILE_Item[t][r].name.indexOf(f)>-1||(ALLFILE_Item[t][r].miaoshu||"").indexOf(f)>-1)&&(ALLFILE_Item[t][r].itemtype=e,o.push(ALLFILE_Item[t][r]),e<9?s.push(ALLFILE_Item[t][r]):e==9?h.push(ALLFILE_Item[t][r]):c.push(ALLFILE_Item[t][r]))}u=[[{field:"itemtype",width:66,title:"type",sort:!0},{field:"ID",width:40,title:"ID"},{field:"name",width:100,title:"名称",sort:!0},{field:"miaoshu",width:410,title:"描述"}]];i.render({elem:"#item-table-all",cellMinWidth:40,height:layui.$(".layui-layer-adminRight").height()-170,cols:u,data:o,limit:99999});i.render({elem:"#item-table-l9",cellMinWidth:40,height:layui.$(".layui-layer-adminRight").height()-170,cols:u,data:s,limit:99999});i.render({elem:"#item-table-e9",cellMinWidth:40,height:layui.$(".layui-layer-adminRight").height()-170,cols:u,data:h,limit:99999});i.render({elem:"#item-table-b9",cellMinWidth:40,height:layui.$(".layui-layer-adminRight").height()-170,cols:u,data:c,limit:99999})});n("#btn_rolesearch").click(function(){var u=n("#rolesearchkey").val(),e=[],o=[],s=[],h=[],c,t,f,r;for(c in ALLFILE_Item.ROLEFILE)t=ALLFILE_Item.ROLEFILE[c],(u==""||t.ID==u||t.roleName.indexOf(u)>-1||(t.miaoShu||"").indexOf(u)>-1)&&(f=parseInt(t.star),f==7?e.push(t):f==6?o.push(t):f==5?s.push(t):h.push(t));r=[[{field:"ID",width:70,title:"ID",sort:!0},{field:"roleName",width:100,title:"名称"},{field:"HP",width:100,title:"HP",sort:!0},{field:"HPAdd",width:100,title:"HP成长",sort:!0},{field:"MP",width:100,title:"MP",sort:!0},{field:"MPAdd",width:100,title:"MP成长",sort:!0},{field:"atk",width:100,title:"武力",sort:!0},{field:"atkAdd",width:100,title:"武力成长",sort:!0},{field:"ts",width:100,title:"统帅",sort:!0},{field:"tsAdd",width:100,title:"统帅成长",sort:!0},{field:"yl",width:100,title:"妖力",sort:!0},{field:"ylAdd",width:100,title:"妖力成长",sort:!0},{field:"def",width:100,title:"防御",sort:!0},{field:"defAdd",width:100,title:"防御成长",sort:!0},{field:"SPEED",width:100,title:"速度",sort:!0},{field:"speedAdd",width:100,title:"速度成长",sort:!0},{field:"miaoShu",width:100,title:"描述"}]];i.render({elem:"#role-table-7",cellMinWidth:40,height:layui.$(".layui-layer-adminRight").height()-170,cols:r,data:e,limit:99999});i.render({elem:"#role-table-6",cellMinWidth:40,height:layui.$(".layui-layer-adminRight").height()-170,cols:r,data:o,limit:99999});i.render({elem:"#role-table-5",cellMinWidth:40,height:layui.$(".layui-layer-adminRight").height()-170,cols:r,data:s,limit:99999});i.render({elem:"#role-table-4-",cellMinWidth:40,height:layui.$(".layui-layer-adminRight").height()-170,cols:r,data:h,limit:99999})});n("#btn_uploadData").click(function(){t.confirm("上传存档前请注销游戏！！！！",{icon:3,title:"警告",btn:["上传","取消"]},function(){t.closeAll("dialog");t.load(2);n.ajax({url:window.location.pathname+"?a=upload&uid="+uid,"async":!0,type:"POST",data:JSON.stringify(player_data),dataType:"json",success:function(n){t.closeAll("loading");n.ok?t.msg("成功"):t.msg(n.msg)},error:function(n){t.closeAll("loading");t.msg(n.responseText,{icon:2})}})},function(){})});n(".signdata .layui-btn").click(function(){n.ajax({url:window.location.pathname+"?a=sign&uid="+uid,"async":!0,type:"POST",data:n(".signdata textarea.data").val(),dataType:"json",success:function(i){if(t.closeAll("loading"),i.ok){var r="Sign: "+i.Sign+"\r\n";r+="Server-Time: "+i.ServerTime+"\r\n";r+="Sign: "+i.Sign2;n(".signdata textarea.res").val(r)}else t.msg(i.msg)},error:function(n){t.closeAll("loading");t.msg(n.responseText,{icon:2})}})});n("#btn_delete").click(function(){t.confirm('确定要从<span style="color:red">本系统<\/span>中删除此账号相关信息吗？<br/> 注：仍然可以登录游戏',{icon:3,title:"警告",btn:["确定","取消"]},function(){t.closeAll("dialog");t.load(2);n.ajax({url:window.location.pathname+"?a=del&uid="+uid,"async":!0,type:"POST",data:JSON.stringify(player_data),dataType:"json",success:function(n){t.closeAll("loading");n.ok?location.reload():t.msg(n.msg)},error:function(n){t.closeAll("loading");t.msg(n.responseText,{icon:2})}})},function(){})})});